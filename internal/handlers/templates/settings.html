<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night Routine - Settings</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-6 max-w-4xl">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">Settings</h1>

        <div class="mb-6">
            <a href="/" class="inline-block bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-6 rounded">‚Üê Back to Home</a>
        </div>

        {{if .ErrorMessage}}
        <div class="bg-red-50 border border-red-400 text-red-800 px-4 py-3 rounded mb-4">
            <strong class="font-bold">Error:</strong>
            <span>{{.ErrorMessage}}</span>
        </div>
        {{end}}

        {{if .SuccessMessage}}
        <div class="bg-green-50 border border-green-400 text-green-800 px-4 py-3 rounded mb-4">
            <strong class="font-bold">Success:</strong>
            <span>{{.SuccessMessage}}</span>
        </div>
        {{end}}

        <div class="bg-orange-50 border border-orange-400 text-orange-800 px-4 py-3 rounded mb-6">
            <strong class="block font-bold mb-2">Important:</strong>
            Changes to settings will affect the fairness algorithm and existing schedule assignments.
            The calendar will be automatically synced after saving changes.
        </div>

        <form action="/settings/update" method="POST">
            <!-- Parent Configuration -->
            <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">Parent Names</h2>
                <p class="text-gray-600 mb-4">Names of the two parents who will be assigned night routine duties.</p>

                <div class="mb-4">
                    <label for="parent_a" class="block text-sm font-medium text-gray-700 mb-2">Parent A Name:</label>
                    <input type="text" id="parent_a" name="parent_a" value="{{.ParentA}}" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                    <div class="text-sm text-gray-500 mt-1">The name that will appear in calendar events.</div>
                </div>

                <div class="mb-4">
                    <label for="parent_b" class="block text-sm font-medium text-gray-700 mb-2">Parent B Name:</label>
                    <input type="text" id="parent_b" name="parent_b" value="{{.ParentB}}" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                    <div class="text-sm text-gray-500 mt-1">The name that will appear in calendar events.</div>
                </div>
            </div>

            <!-- Availability Configuration -->
            <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">Availability</h2>
                <p class="text-gray-600 mb-4">Select days when each parent is unavailable for night routine duties.</p>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">{{.ParentA}} - Unavailable Days:</label>
                    <div class="space-y-2">
                        {{range .AllDaysOfWeek}}
                        <label class="flex items-center py-2 px-3 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="checkbox" name="parent_a_unavailable" value="{{.}}"
                                class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer">
                            <span class="ml-3 text-gray-700">{{.}}</span>
                        </label>
                        {{end}}
                    </div>
                    <div class="text-sm text-gray-500 mt-2">Leave unchecked if available all days.</div>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-3">{{.ParentB}} - Unavailable Days:</label>
                    <div class="space-y-2">
                        {{range $.AllDaysOfWeek}}
                        <label class="flex items-center py-2 px-3 hover:bg-gray-50 rounded cursor-pointer">
                            <input type="checkbox" name="parent_b_unavailable" value="{{.}}"
                                class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer">
                            <span class="ml-3 text-gray-700">{{.}}</span>
                        </label>
                        {{end}}
                    </div>
                    <div class="text-sm text-gray-500 mt-2">Leave unchecked if available all days.</div>
                </div>
            </div>

            <!-- Schedule Configuration -->
            <div class="bg-white border border-gray-300 rounded-lg p-6 mb-6">
                <h2 class="text-2xl font-semibold text-gray-900 mb-2">Schedule Settings</h2>
                <p class="text-gray-600 mb-4">Configure how the schedule is generated and updated.</p>

                <div class="mb-4">
                    <label for="update_frequency" class="block text-sm font-medium text-gray-700 mb-2">Update Frequency:</label>
                    <select id="update_frequency" name="update_frequency" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                        <option value="daily" {{if eq .UpdateFrequency "daily"}}selected{{end}}>Daily</option>
                        <option value="weekly" {{if eq .UpdateFrequency "weekly"}}selected{{end}}>Weekly</option>
                        <option value="monthly" {{if eq .UpdateFrequency "monthly"}}selected{{end}}>Monthly</option>
                    </select>
                    <div class="text-sm text-gray-500 mt-1">How often the schedule should be automatically updated.</div>
                </div>

                <div class="mb-4">
                    <label for="look_ahead_days" class="block text-sm font-medium text-gray-700 mb-2">Look Ahead Days:</label>
                    <input type="number" id="look_ahead_days" name="look_ahead_days" value="{{.LookAheadDays}}" min="1" max="365" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                    <div class="text-sm text-gray-500 mt-1">Number of days in advance to schedule (recommended: 7-30).</div>
                </div>

                <div class="mb-4">
                    <label for="past_event_threshold_days" class="block text-sm font-medium text-gray-700 mb-2">Past Event Threshold (Days):</label>
                    <input type="number" id="past_event_threshold_days" name="past_event_threshold_days"
                        value="{{.PastEventThresholdDays}}" min="0" max="30" required
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-base">
                    <div class="text-sm text-gray-500 mt-1">How many days in the past to accept manual calendar changes (0-30).</div>
                </div>
            </div>

            <div class="flex flex-col sm:flex-row gap-3">
                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-medium py-3 px-6 rounded">Save Settings</button>
                <a href="/" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-6 rounded text-center">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        // Dynamic checkbox handling for availability
        document.addEventListener('DOMContentLoaded', function () {
            const parentAChecked = {{js .ParentAUnavailable}};
            const parentBChecked = {{js .ParentBUnavailable}};

            document.querySelectorAll('input[name="parent_a_unavailable"]').forEach(function (checkbox) {
                if (parentAChecked.includes(checkbox.value)) {
                    checkbox.checked = true;
                }
            });

            document.querySelectorAll('input[name="parent_b_unavailable"]').forEach(function (checkbox) {
                if (parentBChecked.includes(checkbox.value)) {
                    checkbox.checked = true;
                }
            });
        });
    </script>

</body>

</html>
